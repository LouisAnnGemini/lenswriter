# LensWriter 功能说明书

LensWriter 是一款专为作家和创作者设计的非线性写作工具，它通过独特的“透镜 (Lens)”系统，帮助您在写作过程中捕捉灵感、管理设定、追踪伏笔，并解决创作冲突。

## 1. 作品管理 (Works)

在左侧边栏，您可以管理您的所有创作项目。

*   **创建作品**：在底部的输入框中输入新作品的名称，按回车键即可创建。
*   **切换作品**：点击列表中的作品名称，即可切换到该作品的编辑界面。
*   **修改作品图标**：
    *   在侧边栏**展开**状态下，点击作品名称左侧的图标，可以弹出图标选择器。
    *   支持选择内置颜色的书籍图标，也支持输入任意 Emoji 作为图标。
    *   *注：当侧边栏**收起**时，点击图标将直接切换到该作品，而不是修改图标。*
*   **重命名作品**：
    *   将鼠标悬停在作品名称上，点击出现的**铅笔图标**。
    *   或者直接**双击**作品名称。
    *   输入新名称后，按回车键或点击外部即可保存。
*   **删除作品**：
    *   将鼠标悬停在作品名称上，点击出现的**垃圾桶图标**。
    *   系统会显示红色的 **DELETE?** 提示，点击 **✓ (确认)** 将彻底删除该作品及其所有内容（章节、场景、角色等），点击 **✕ (取消)** 则放弃操作。
*   **排序作品**：按住作品名称左侧的**六点抓取图标**，上下拖动即可调整作品顺序。
*   **导入/导出**：
    *   **Export (导出)**：点击底部的 Export 按钮，将所有作品数据导出为 `.json` 文件备份。
    *   **Import (导入)**：点击底部的 Import 按钮，选择之前导出的 `.json` 文件，恢复数据。

## 2. 写作界面 (Writing Tab)

这是您进行创作的主要区域，包含章节列表和编辑器。

### 2.1 章节与场景管理
*   **创建章节**：点击左侧章节列表底部的 "+ New Chapter" 按钮。
    *   *注：新建章节时，系统会自动为其创建一个默认场景 (New Scene) 和一个初始文本块，方便您直接开始写作。*
*   **创建场景**：在某个章节下，点击 "+ New Scene" 按钮。
    *   *注：新建场景时，系统会自动创建一个初始文本块。*
*   **重命名**：双击章节或场景名称进行重命名。
*   **排序**：拖动章节或场景标题，可以调整它们的顺序。场景也可以在不同章节之间拖动。
*   **删除**：
    *   点击章节或场景右侧的**垃圾桶图标**。
    *   系统会在当前行显示 **DELETE?** 确认提示。
    *   点击 **✓ (确认)** 执行删除，点击 **✕ (取消)** 放弃操作。这种行内确认方式避免了弹窗干扰，且在移动端操作更友好。

### 2.2 文本编辑
*   **普通文本**：在编辑器中直接输入文本。每个段落都是一个独立的块 (Block)。
*   **块操作菜单**：将鼠标悬停在文本块上，块的**左下方**会出现操作按钮：
    *   **Add Text**：在当前块下方插入一个新的普通文本块。
    *   **Add Lens**：在当前块下方插入一个新的透镜块。
    *   **Delete Block (垃圾桶)**：删除当前块。
*   **向上合并 (Merge Up)**：当鼠标悬停在文本块上时，顶部会出现 `↑ Merge Up` 按钮。点击可将当前块与上一个文本块合并。
    *   *优化体验*：合并操作经过特殊优化，即使在长文本中进行合并并继续打字，页面滚动位置也会保持稳定，不会出现跳动。
*   **块描述与完成状态**：将鼠标悬停在普通文本块上，块的**右侧**会出现两个额外功能按钮：
    *   **块描述 (气泡图标)**：点击可在文本块下方展开一个多行输入框，用于对该段落进行批注或大纲描述。再次点击可关闭并删除描述。
        *   *新功能*：在批注框的最右侧，现在也有一个圆圈图标。点击它可以快速切换该文本块的完成状态（空心圆圈为未完成，实心勾选为已完成）。
    *   **完成状态 (打钩图标)**：点击可切换该文本块的完成状态（点亮为绿色表示已完成，熄灭为灰色表示未完成）。

### 2.3 Lens (透镜) 系统
Lens 是本作的核心功能，用于在正文中嵌入元数据、设定或思考。

*   **颜色分类**：
    *   🔴 **Red (冲突/问题)**：标记剧情漏洞、逻辑矛盾或需要修改的地方。
    *   🔵 **Blue (设定/世界观)**：标记关于世界观、魔法系统或科技的设定。
    *   🟢 **Green (伏笔/线索)**：标记埋下的伏笔或重要线索。
    *   🟡 **Yellow (灵感/备注)**：记录突发的灵感或备忘录。
    *   🟣 **Purple (角色发展)**：标记角色的心理变化或重要时刻。
    *   ⚫ **Black (隐藏内容)**：**特殊功能**。用于隐藏剧透或暂时不想看到的内容。
        *   **隐藏逻辑**：黑色 Lens 中的文字默认是**透明/隐藏**的。
        *   **查看逻辑**：只有当您点击黑色 Lens 的输入框（获得焦点）时，文字才会显示出来。

*   **Lens 操作**：
    *   **切换颜色**：点击 Lens 左上角的颜色圆点，可以随时更改 Lens 的颜色。
    *   **移除 Lens**：点击右上角的垃圾桶图标，可以将 Lens 移除，但**保留其中的文本**（变回普通文本块）。
    *   **链接 Lens (自动双向链接)**：
        *   点击 Lens 右上角的链接图标，可以选择其他 Lens 进行关联。
        *   **双向同步**：当您将 Lens A 链接到 Lens B 时，系统会自动在 Lens B 中也添加指向 Lens A 的链接，无需手动操作。
        *   **智能清理**：当您删除某个 Lens 或其所属的章节/作品时，所有指向该 Lens 的链接都会被自动清理，防止出现死链。
        *   关联后，底部会出现跳转按钮，点击可快速跳转到相关的 Lens。

### 2.4 专注模式 (Focus Mode)
LensWriter 提供两种写作视图，以适应不同的创作状态：

*   **普通模式 (默认)**：
    *   **布局**：采用“平铺”式设计，文本区域较宽 (Max-Width: 5xl)，左右边距较小。
    *   **目的**：适合需要频繁参考侧边栏目录、角色资料或进行大纲梳理的场景，最大化利用屏幕空间。
*   **专注模式**：
    *   **进入**：点击顶部导航栏右上角的 **全屏图标 (Maximize)**。
    *   **布局**：隐藏顶部导航栏和所有侧边栏，文本区域收窄 (Max-Width: 3xl) 并居中，增加左右留白。
    *   **目的**：提供沉浸式的写作环境，模拟纸张阅读体验，减少干扰。
    *   **退出**：点击屏幕右上角的 **悬浮退出图标 (Minimize)** 即可返回普通模式。

### 2.5 伪装模式 (Disguise Mode)
除了专注模式，LensWriter 还提供了一种特殊的“伪装模式”，让您的写作界面看起来像是一篇纯净的连续文本或编译后的文章，非常适合在公共场合使用。

*   **进入方式**：点击顶部导航栏右上角的 **眼睛图标 (Eye)** 即可进入。
*   **退出方式**：
    *   点击屏幕右上角悬浮的 **闭眼图标 (EyeOff)**。
    *   或者在任意状态下按下键盘上的 **`Esc`** 键，即可快速全局退出。
*   **界面表现**：
    *   **隐藏所有操作按钮**：隐藏所有的“Add Text”、“Add Lens”按钮（包括悬浮快捷菜单和底部按钮），隐藏“Merge Up”按钮，以及右侧的块操作按钮（添加描述、标记完成、删除等）。
    *   **隐藏侧边栏**：自动隐藏右侧的目录 (Directory) 侧边栏。
    *   **纯文本排版**：文本块之间的间距变得更紧凑，移除了块的圆角、边距和高亮背景，使所有内容平铺显示，看起来就像是一篇连续的纯文本文章。

### 2.6 块目录 (Block Directory / TOC)
当您在章节或场景中为文本块添加了**块描述**后，编辑器右侧会自动生成一个目录侧边栏。
*   **层级展示**：目录会按照“章节 > 场景”的结构，汇总显示所有带有描述的文本块。
*   **快速跳转**：点击目录中的条目，页面会平滑滚动到对应的文本块并短暂高亮。
*   **状态指示**：如果文本块被标记为“已完成”，其在目录中的条目会显示为醒目的浅绿色背景；未完成则显示为浅灰色。

## 3. 角色管理 (Characters Tab)

在顶部的 **Characters** 标签页中，您可以管理作品中的角色。

*   **添加角色**：点击 "+ Add Character" 按钮。
*   **编辑角色**：点击角色卡片，可以编辑姓名、描述和头像颜色。
*   **自定义字段 (Character Fields)**：点击右上角的齿轮图标 (⚙️) 可配置角色的自定义属性（如年龄、阵营等）。
    *   **字段排序**：在配置弹窗中，按住字段左侧的拖拽手柄 (`⋮⋮`) 上下拖动，即可对所有自定义字段进行自由排序，排序结果会实时反映在所有角色的详情页中。
*   **排序角色**：拖动角色卡片可以调整顺序。
*   **场景关联 (Appearance Tracker)**：
    *   在角色详情页的 **Appearances Tracker** 区域，可以看到该角色出现的所有场景。
    *   列表按场景顺序排列，显示场景标题和索引（如 1-2 表示第1章第2场景）。
    *   **备注功能**：每个场景下都有一个多行文本框，您可以记录该角色在此场景中的状态、心情或伏笔。文本框高度会自动适应内容长度。
    *   **跳转**：点击 "Go to Scene" 按钮可直接跳转到对应场景进行写作。

## 4. 透镜概览 (Lenses Tab)

在顶部的 **Lenses** 标签页中，您可以查看全书所有的 Lens，进行全局梳理。

*   **自定义副标题**：页面标题 "Color Lenses" 下方的描述文本是可编辑的。您可以直接点击修改它，支持多行自动换行。该描述是按作品 (Work) 独立保存的，不同作品可以有不同的描述。
*   **瀑布流展示**：所有 Lens 以卡片形式展示，包含位置信息（章节 > 场景）。
*   **筛选功能**：
    *   **按章节筛选**：选择特定章节，只显示该章节（及其子场景）下的 Lens。
    *   **按颜色筛选**：只显示特定颜色的 Lens（例如只看所有红色的冲突点）。
*   **详情编辑**：
    *   点击任意 Lens 卡片，右侧会弹出详情面板。
    *   **编辑内容**：可以直接修改 Lens 的正文内容。
    *   **私有笔记 (Private Notes)**：在这里可以添加**仅在详情页可见**的备注，不会显示在写作界面的正文中。
    *   **管理链接**：可以添加或移除与其他 Lens 的关联。
*   **黑色 Lens 支持**：
    *   在概览列表中，黑色 Lens 的内容会被隐藏，显示为 "Hidden Content"。
    *   点击进入详情面板后，点击文本框才能查看真实内容。

## 5. 编译与导出 (Compile Tab)

在顶部的 **Compile** 标签页中，您可以将作品导出为结构化的 Word 文档 (.docx)。

*   **选择内容**：
    *   **Select Whole Work**：一键选中整部作品的所有章节和场景。
    *   **Select Current Chapter**：选中当前正在编辑的章节及其所有场景。
    *   **Select Current Scene**：仅选中当前正在编辑的场景。
    *   **手动选择**：在左侧列表中，您可以手动勾选特定的章节或场景。
        *   勾选章节会自动选中该章节下的所有场景。
        *   点击章节右侧的箭头可以展开/收起场景列表。
*   **预览功能**：
    *   右侧面板会实时显示选中内容的纯文本预览。
    *   **自动合并**：同一章节内的多个场景会被合并成连续的文本，场景之间会有空行分隔。
    *   **Lens 处理**：Lens 中的文字会被视为普通正文一并输出（黑色隐藏 Lens 除外）。
    *   **Copy Text**：点击按钮可将预览内容复制到剪贴板。
*   **导出文档**：
    *   点击 **Export .docx** 按钮，系统会将选中内容生成一个 Word 文档并下载。
    *   文档结构：章节标题会被设置为一级标题 (Heading 1)，正文内容保持默认格式。

## 6. 移动端适配 (Mobile Adaptation)

LensWriter 针对移动设备进行了深度优化，提供流畅的单手操作体验。

### 6.1 导航与布局
*   **底部导航栏**：Writing、Lenses、Characters 的标签页切换移动到了屏幕底部，方便单手点击。
*   **侧边栏菜单**：
    *   Works 侧边栏默认隐藏。
    *   点击左上角的 **菜单按钮 (☰)** 可展开侧边栏。
    *   选择作品后，侧边栏会自动收起，进入该作品的章节目录。

### 6.2 写作界面 (Writing Tab)
*   **全屏目录与编辑**：
    *   章节目录 (Outline) 默认全屏显示。
    *   点击任意章节或场景，自动进入全屏的**文字编辑界面**。
*   **返回导航**：
    *   在编辑界面，左上角显示 **返回按钮 (<)**，点击即可退回章节目录。
    *   在章节目录界面，左上角显示 **菜单按钮 (☰)**，点击可切换作品。
*   **排版优化**：
    *   章节和场景标题字号自动适配，过长时自动换行。
    *   人物场景备注输入框改为自动高度，支持长文本输入。

### 6.3 角色管理 (Characters Tab)
*   **全屏列表**：进入 Characters 标签页时，全屏显示角色列表。
*   **全屏详情**：点击角色卡片，进入全屏的角色详情页。
*   **返回列表**：详情页左上角提供 **< Back to List** 按钮。

### 6.4 透镜概览 (Lenses Tab)
*   **纵向筛选**：顶部的章节和颜色筛选选项在手机上纵向排列，易于操作。
*   **全屏详情**：点击 Lens 卡片，详情侧边栏会全屏覆盖显示，提供专注的阅读和编辑环境。

## 7. 自动保存 (Auto-Save)

LensWriter 内置了实时自动保存功能，确保您的创作数据安全。

*   **实时保存**：您的每一次输入、修改、拖拽排序等操作，都会立即保存到浏览器的 **本地存储 (LocalStorage)** 中。
*   **防丢失**：即使您刷新页面或意外关闭浏览器，再次打开时，所有数据都会自动恢复到最新状态。
*   **数据导出**：建议定期使用 **Export** 功能将数据导出为 JSON 文件进行本地备份，以防清理浏览器缓存导致数据丢失。

